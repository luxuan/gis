<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>ArcGIS</title>

    <link rel="stylesheet" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.4/js/dojo/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.4/js/esri/css/esri.css">

    <script>dojoConfig = { parseOnLoad:true }</script>
    <script src="http://serverapi.arcgisonline.com/jsapi/arcgis/3.4/"></script>
    <script src="app/BaseLayer.js"></script>

    <script type="text/javascript"> 
        dojo.require("dojo.parser");
        dojo.require("dojo.data.ItemFileReadStore");
        dojo.require("esri.map");

/*
        dojo.require("dijit/MenuBar");
        dojo.require("dijit/MenuBarItem");
        dojo.require("dijit/PopupMenuBarItem");
        dojo.require("dijit/DropDownMenu");
        dojo.require("dijit/MenuItem");
        //dojo.require("esri.map");
*/

        dojo.require("dijit.MenuBar");
        dojo.require("dijit.MenuBarItem");
        dojo.require("dijit.PopupMenuBarItem");
        dojo.require("dijit.DropDownMenu");
        dojo.require("dijit.MenuItem");

  dojo.require("dijit.Dialog");
  dojo.require("dijit.form.TextBox");  
  dojo.require("dijit.form.TimeTextBox");
  dojo.require("dijit.form.Button");
  dojo.require("dijit.form.DateTextBox");
  dojo.require("dijit.form.FilteringSelect");

dojo.require("dijit.form.CheckBox");
dojo.require("dijit.Menu");
dojo.require("dijit.CheckedMenuItem");


      //dojo.require(["dijit/MenuBar", "dijit/MenuBarItem", "dijit/PopupMenuBarItem", "dijit/DropDownMenu", "dijit/MenuItem"]);

        var map;
        var baseLayer;
        function init() {
            esri.config.defaults.io.corsDetection=false;//屏蔽 Access-Control-Allow-Origin异常
            map = new esri.Map("mapDiv", {
                extent: new esri.geometry.Extent({ 
                    "xmin": 90.53154754638672, "ymin": 23.68379211425781,
                    "xmax": 126.32555389404297, "ymax": 42.82112121582031, 
                    "spatialReference": { "wkid": 4326} })
            });
            map.addLayer(new esri.layers.ArcGISDynamicMapServiceLayer("http://localhost:8399/arcgis/rest/services/weather/MapServer"));
            //http://server.arcgisonline.com/ArcGIS/rest/services/ESRI_StreetMap_World_2D/MapServer
            //http://lius-pc:8399/arcgis/rest/services/weather/MapServer
            //http://lius-pc:8399/arcgis/services/weather/ArcGISTiledMapServiceLayer//不能访问
            baseLayer = new BaseLayer(map, "Data/PointData_v.json", "#ffff00");
            dojo.connect(map, "onLoad", defaultSetting);
        }

        dojo.addOnLoad(init);

        function defaultSetting() {
//            var baseLayerDiv = dojo.query('#baseLayerDiv');  //TODO check the div and set onchanged event
        }
        function changeBase(checked) {
            console.log('changeBase', checked);
            if(checked) {
                baseLayer.show();
            } else {
                baseLayer.hide();
            }
        }
        function changePipe(checked) {
            console.log('changePipe', checked);
//            baseLayer.hide();
        }
        function changeHot(checked) {
            console.log('changeHot', checked);
//            baseLayer.hide();
        }

    </script>
</head>
<body class="claro">
    <div id="mapDiv" style="width:900px; height:600px; border:1px solid #000;">
        <div style="position:absolute; left:450px; top:10px; z-Index:999;">

            <div data-dojo-type="dijit/MenuBar" id="navMenu">


                <div dojoType="dijit.PopupMenuBarItem"><!-- 不能是dijit.form.DropDownButton -->
                  <span>搜索</span>
                  <div dojoType="dijit.TooltipDialog" id="tooltipDlg" title="Enter Login information"
                    execute="console.log('submitted w/args:\n' + dojo.toJson(arguments[0], true));">
                    <table>
                      <tr>
                        <td><label for="user">关键字:</label></td>
                        <td><input dojoType=dijit.form.TextBox type="text" name="user" id="user"></td>
                      </tr>
                        <tr>
                            <td colspan="2" align="center">
                                <button dojoType=dijit.form.Button type="submit" name="submit">搜索</button>
                            </td>
                        </tr>

                    </table>
                  </div>
                </div>

                |<div data-dojo-type="dijit.PopupMenuBarItem">
                    <span>图层</span>
                    <div data-dojo-type="dijit.Menu">
                        <!--<div data-dojo-type="dijit.CheckedMenuItem" data-dojo-props="onClick:setTextBoxPadding">0px</div>-->
                        <!--data-dojo-props="onClick:setTextBoxPadding"不能有啊-->
                        <div data-dojo-type="dijit.CheckedMenuItem" id="baseLayerDiv" data-dojo-props="onChange:changeBase" >基站</div>
                        <div data-dojo-type="dijit.CheckedMenuItem" data-dojo-props="onChange:changePipe">管网</div>
                    </div>
                </div>

                |<div data-dojo-type="dijit/PopupMenuBarItem">
                    <span>分布</span>
                    <div data-dojo-type="dijit.Menu">
                        <div data-dojo-type="dijit.CheckedMenuItem" data-dojo-props="onChange:changeBase">水质</div>
                        <div data-dojo-type="dijit.CheckedMenuItem" data-dojo-props="onChange:changePipe">水压</div>
                        <div data-dojo-type="dijit.CheckedMenuItem" data-dojo-props="onChange:changePipe">流量</div>
                    </div>
                </div>

                |<div data-dojo-type="dijit/PopupMenuBarItem">
                <span>异常告警</span>
                <div data-dojo-type="dijit.Menu">
                    <div data-dojo-type="dijit.CheckedMenuItem" data-dojo-props="onChange:changeBase">水质</div>
                    <div data-dojo-type="dijit.CheckedMenuItem" data-dojo-props="onChange:changePipe">水压</div>
                    <div data-dojo-type="dijit.CheckedMenuItem" data-dojo-props="onChange:changePipe">漏水</div>
                </div>
                </div>

                |<div data-dojo-type="dijit/MenuBarItem">
                    爆管
                </div>

                |<div data-dojo-type="dijit/PopupMenuBarItem">
                    <span>工具</span>
                    <div data-dojo-type="dijit/DropDownMenu" >
                        <div data-dojo-type="dijit/MenuItem" data-dojo-props="iconClass:'dijitEditorIcon dijitEditorIconCut',
                                                onClick:function(){console.log('测距')}">测距</div>
                        <div data-dojo-type="dijit/MenuItem" data-dojo-props="iconClass:'dijitEditorIcon dijitEditorIconCopy',
                                                onClick:function(){console.log('截图')}">截图</div>
                        <div data-dojo-type="dijit/MenuItem" data-dojo-props="iconClass:'dijitEditorIcon dijitEditorIconCopy',
                                                onClick:function(){console.log('搜索')}">搜索</div>
                    </div>
                </div>



            </div>

      </div>
    </div>
</body>
</html>
